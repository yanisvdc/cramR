<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Cram Bandit Simulation â€¢ cramR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Cram Bandit Simulation">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<!-- Load Inter font --><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&amp;display=swap" rel="stylesheet">
<style>
  :root {
    --primary-gradient: linear-gradient(135deg, #2c3e50, #3498db);
    --hover-shadow: 0 4px 15px rgba(0,0,0,0.2);
  }

  .navbar {
    background-color: rgba(255, 255, 255, 0.95); /* Light background with slight transparency */
    box-shadow: 0 2px 10px rgba(0,0,0,0.1); /* Optional shadow for depth */
  }

  body {
    padding-top: 80px;
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  }

  h1, h2, h3, h4, h5, h6 {
    font-family: 'Inter', sans-serif;
  }

  code, pre, kbd {
    font-family: 'JetBrains Mono', monospace;
    background-color: #f5f5f5;
    padding: 0.2em 0.4em;
    border-radius: 4px;
    font-size: 90%;
  }

  pre {
    overflow-x: auto;
  }

  pre code {
    padding: 1em;
    display: block;
  }

  .navbar-brand img {
    height: 40px;
    transition: transform 0.3s ease;
  }

  .navbar-brand:hover img {
    transform: scale(1.05);
  }

  .hero-banner {
    background: var(--primary-gradient);
    padding: 6rem 1rem;
    color: white;
    text-shadow: 0 2px 4px rgba(0,0,0,0.2);
  }

  .feature-card {
    background: white;
    border-radius: 12px;
    padding: 2rem;
    margin: 1rem;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    transition: all 0.3s ease;
  }

  .feature-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--hover-shadow);
  }

  /* Add hover effect to make the navbar more readable */
  .navbar:hover {
    background-color: rgba(255, 255, 255, 1); /* Fully visible on hover */
  }

  /* Add space below the navbar to prevent cutting off content */
  main {
    padding-top: 1rem;
  }
</style>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">cramR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/cram_policy_part_1.html">Introduction &amp; Cram Policy part 1</a></li>
    <li><a class="dropdown-item" href="../articles/quickstart.html">Quick Start</a></li>
    <li><a class="dropdown-item" href="../articles/cram_policy_part_2.html">Cram Policy part 2</a></li>
    <li><a class="dropdown-item" href="../articles/cram_ml.html">Cram ML</a></li>
    <li><a class="dropdown-item" href="../articles/cram_bandit.html">Cram Bandit</a></li>
    <li><a class="dropdown-item" href="../articles/cram_bandit_helpers.html">Cram Bandit Helpers</a></li>
    <li><a class="dropdown-item" href="../articles/cram_policy_simulation.html">Cram Policy Simulation</a></li>
    <li><a class="dropdown-item" href="../articles/cram_bandit_simulation.html">Cram Bandit Simulation</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-resources" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Resources</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-resources">
<li><a class="dropdown-item" href="../reference/index.html">Function Reference</a></li>
    <li><a class="dropdown-item" href="../news/index.html">Release Notes</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/yanisvdc/cramR" aria-label="GitHub repository"><span class="fa fa-brands fa-github"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://www.hbs.edu/ris/Publication%20Files/2403.07031v1_a83462e0-145b-4675-99d5-9754aa65d786.pdf" aria-label="Research paper"><span class="fa fa-solid fa-file-pdf"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<link href="cram_bandit_simulation_files/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="cram_bandit_simulation_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><link href="cram_bandit_simulation_files/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="cram_bandit_simulation_files/datatables-binding-0.33/datatables.js"></script><link href="cram_bandit_simulation_files/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="cram_bandit_simulation_files/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="cram_bandit_simulation_files/dt-core-1.13.6/js/jquery.dataTables.min.js"></script><link href="cram_bandit_simulation_files/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="cram_bandit_simulation_files/crosstalk-1.2.1/js/crosstalk.min.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Cram Bandit Simulation</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/yanisvdc/cramR/blob/HEAD/vignettes/cram_bandit_simulation.Rmd" class="external-link"><code>vignettes/cram_bandit_simulation.Rmd</code></a></small>
      <div class="d-none name"><code>cram_bandit_simulation.Rmd</code></div>
    </div>

    
    
<p>This vignette demonstrates the simulation capabilities included in
the cramR package. The simulation code is primarily intended for
reproducing experimental results from the associated theoretical papers
and for validating the performance of the Cram method under controlled
data-generating processes. While not intended for direct use in
practical applications, these simulations allow users to benchmark and
understand the empirical behavior of the method in synthetic
environments.</p>
<div class="section level2">
<h2 id="what-is-cram_bandit_sim">What is <code>cram_bandit_sim()</code>?<a class="anchor" aria-label="anchor" href="#what-is-cram_bandit_sim"></a>
</h2>
<p>The <code><a href="../reference/cram_bandit_sim.html">cram_bandit_sim()</a></code> function runs <strong>on-policy
simulation</strong> for contextual bandit algorithms using the Cram
method. It evaluates the statistical properties of policy value
estimates such as:</p>
<ul>
<li><strong>Empirical Bias on Policy Value</strong></li>
<li><strong>Average relative error on Policy Value</strong></li>
<li><strong>RMSE using relative errors on Policy Value</strong></li>
<li><strong>Empirical Coverage of Confidence Intervals</strong></li>
</ul>
<p>This is useful for benchmarking bandit policies under controlled,
simulated environments.</p>
<hr>
</div>
<div class="section level2">
<h2 id="inputs">ðŸ“‹ Inputs<a class="anchor" aria-label="anchor" href="#inputs"></a>
</h2>
<p>You need to provide:</p>
<ul>
<li><p><code>bandit</code>:<br>
A <strong>contextual bandit environment object</strong> that generates
contexts (feature vectors) and rewards for each arm.<br>
Example: <code>ContextualLinearBandit</code>, or any object following
the <a href="https://github.com/Nth-iteration-labs/contextual" class="external-link">contextual
package</a> interface.</p></li>
<li><p><code>policy</code>:<br>
A <strong>policy object</strong> that takes in a context and selects an
arm (action) at each timestep.<br>
Example: <code>BatchContextualLinTSPolicy</code>, or any compatible <a href="https://github.com/Nth-iteration-labs/contextual" class="external-link">contextual
package</a> policy.</p></li>
<li><p><code>horizon</code>:<br>
An <strong>integer</strong> specifying the number of timesteps (rounds)
per simulation.<br>
Each simulation will run for exactly <code>horizon</code>
steps.</p></li>
<li><p><code>simulations</code>:<br>
An <strong>integer</strong> specifying the number of independent Monte
Carlo simulations to perform.<br>
Each simulation will independently reset the environment and
policy.</p></li>
<li>
<p>Optional Parameters:</p>
<ul>
<li><p><code>alpha</code>:<br>
A <strong>numeric value</strong> between 0 and 1 specifying the
significance level for confidence intervals when calculating empirical
coverage.<br>
Default: <code>0.05</code> (for 95% confidence intervals).</p></li>
<li><p><code>seed</code>:<br>
An optional <strong>integer</strong> to set the random seed for
reproducibility.<br>
If <code>NULL</code>, no seed is set.</p></li>
<li><p><code>do_parallel</code>:<br>
A <strong>logical</strong> value indicating whether to parallelize the
simulations across available CPU cores.<br>
Default: <code>FALSE</code> (parallelization disabled).<br>
We recommend keeping <code>do_parallel = FALSE</code> unless necessary,
as parallel execution can make it harder for the underlying <a href="https://github.com/Nth-iteration-labs/contextual" class="external-link"><code>contextual</code></a>
package to reliably track simulation history.<br>
In particular, parallel runs may cause missing or incomplete entries in
the recorded history, which are then discarded during analysis.</p></li>
</ul>
</li>
</ul>
<hr>
</div>
<div class="section level2">
<h2 id="example-cram-bandit-simulation">Example: Cram Bandit Simulation<a class="anchor" aria-label="anchor" href="#example-cram-bandit-simulation"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Number of time steps</span></span>
<span><span class="va">horizon</span>       <span class="op">&lt;-</span> <span class="fl">500L</span></span>
<span></span>
<span><span class="co"># Number of simulations </span></span>
<span><span class="va">simulations</span>   <span class="op">&lt;-</span> <span class="fl">100L</span></span>
<span></span>
<span><span class="co"># Number of arms</span></span>
<span><span class="va">k</span> <span class="op">=</span> <span class="fl">4</span></span>
<span></span>
<span><span class="co"># Number of context features</span></span>
<span><span class="va">d</span><span class="op">=</span> <span class="fl">3</span></span>
<span></span>
<span><span class="co"># Reward beta parameters of linear model (the outcome generation models, one for each arm, are linear with arm-specific parameters betas)</span></span>
<span><span class="va">list_betas</span> <span class="op">&lt;-</span> <span class="fu">cramR</span><span class="fu">:::</span><span class="fu">get_betas</span><span class="op">(</span><span class="va">simulations</span>, <span class="va">d</span>, <span class="va">k</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define the contextual linear bandit, where sigma is the scale of the noise in the outcome linear model</span></span>
<span><span class="va">bandit</span>        <span class="op">&lt;-</span> <span class="fu">cramR</span><span class="fu">:::</span><span class="va">ContextualLinearBandit</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>k <span class="op">=</span> <span class="va">k</span>, d <span class="op">=</span> <span class="va">d</span>, list_betas <span class="op">=</span> <span class="va">list_betas</span>, sigma <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define the policy object (choose between Contextual Epsilon Greedy, UCB Disjoint and Thompson Sampling)</span></span>
<span><span class="va">policy</span> <span class="op">&lt;-</span> <span class="fu">cramR</span><span class="fu">:::</span><span class="va">BatchContextualEpsilonGreedyPolicy</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>epsilon<span class="op">=</span><span class="fl">0.1</span>, batch_size<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="co"># policy &lt;- cramR:::BatchLinUCBDisjointPolicyEpsilon$new(alpha=1.0, epsilon=0.1, batch_size=1)</span></span>
<span><span class="co"># policy &lt;- cramR:::BatchContextualLinTSPolicy$new(v = 0.1, batch_size=1)</span></span>
<span></span>
<span></span>
<span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cram_bandit_sim.html">cram_bandit_sim</a></span><span class="op">(</span><span class="va">horizon</span>, <span class="va">simulations</span>,</span>
<span>                            <span class="va">bandit</span>, <span class="va">policy</span>,</span>
<span>                            alpha<span class="op">=</span><span class="fl">0.05</span>, do_parallel <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simulation horizon: 500</span></span>
<span><span class="co">#&gt; Number of simulations: 101</span></span>
<span><span class="co">#&gt; Number of batches: 1</span></span>
<span><span class="co">#&gt; Starting main loop.</span></span>
<span><span class="co">#&gt; Finished main loop.</span></span>
<span><span class="co">#&gt; Completed simulation in 0:00:04.769</span></span>
<span><span class="co">#&gt; Computing statistics.</span></span></code></pre></div>
<p><img src="cram_bandit_simulation_files/figure-html/unnamed-chunk-1-1.png" alt="Cumulative regret curve over time for the selected policy" width="700"></p>
<hr>
</div>
<div class="section level2">
<h2 id="what-does-it-return">What Does It Return?<a class="anchor" aria-label="anchor" href="#what-does-it-return"></a>
</h2>
<p>The output contains:</p>
<p>A <code>data.table</code> with one row per simulation, including:</p>
<ul>
<li>
<code>estimate</code>: estimated policy value<br>
</li>
<li>
<code>variance_est</code>: estimated variance<br>
</li>
<li>
<code>estimand</code>: true policy value (computed from held-out
context data)<br>
</li>
<li>
<code>prediction_error</code>:
<code>estimate - estimand</code><br>
</li>
<li>
<code>est_rel_error</code>: relative error on estimate<br>
</li>
<li>
<code>variance_prediction_error</code>: relative error on
variance<br>
</li>
<li>
<code>ci_lower</code>, <code>ci_upper</code>: bounds of the
confidence interval<br>
</li>
<li>
<code>std_error</code>: standard error</li>
</ul>
<p>Result tables (raw and interactive), reporting:</p>
<ul>
<li><strong>Empirical Bias on Policy Value</strong></li>
<li><strong>Average relative error on Policy Value</strong></li>
<li><strong>RMSE using relative errors on Policy Value</strong></li>
<li><strong>Empirical Coverage of Confidence Intervals</strong></li>
</ul>
<hr>
</div>
<div class="section level2">
<h2 id="example-output-preview">Example Output Preview<a class="anchor" aria-label="anchor" href="#example-output-preview"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sim</span><span class="op">$</span><span class="va">estimates</span><span class="op">)</span></span>
<span><span class="co">#&gt;      sim  estimate variance_est  estimand prediction_error est_rel_error</span></span>
<span><span class="co">#&gt;    &lt;int&gt;     &lt;num&gt;        &lt;num&gt;     &lt;num&gt;            &lt;num&gt;         &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:     1 0.5017577  0.008990666 0.5445425      -0.04278478   -0.07857014</span></span>
<span><span class="co">#&gt; 2:     2 0.6189290  0.000770998 0.5981170       0.02081205    0.03479596</span></span>
<span><span class="co">#&gt; 3:     3 0.3455183  0.057464183 0.5528602      -0.20734195   -0.37503504</span></span>
<span><span class="co">#&gt; 4:     4 0.5837325  0.001025324 0.5998785      -0.01614596   -0.02691539</span></span>
<span><span class="co">#&gt; 5:     5 0.3333935  0.018343895 0.5228533      -0.18945980   -0.36235750</span></span>
<span><span class="co">#&gt; 6:     6 0.5137367  0.001389443 0.4651693       0.04856737    0.10440794</span></span>
<span><span class="co">#&gt;    variance_prediction_error  std_error    ci_lower  ci_upper</span></span>
<span><span class="co">#&gt;                        &lt;num&gt;      &lt;num&gt;       &lt;num&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:                -0.8807182 0.09481912  0.31591566 0.6875998</span></span>
<span><span class="co">#&gt; 2:                -0.9897709 0.02776685  0.56450699 0.6733510</span></span>
<span><span class="co">#&gt; 3:                -0.2376059 0.23971688 -0.12431818 0.8153547</span></span>
<span><span class="co">#&gt; 4:                -0.9863967 0.03202069  0.52097315 0.6464919</span></span>
<span><span class="co">#&gt; 5:                -0.7566262 0.13543963  0.06793667 0.5988503</span></span>
<span><span class="co">#&gt; 6:                -0.9815659 0.03727523  0.44067855 0.5867948</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim</span><span class="op">$</span><span class="va">interactive_table</span></span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-ac96cb3ee4656e2e9ec3" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-ac96cb3ee4656e2e9ec3">{"x":{"filter":"none","vertical":false,"caption":"<caption>Cram Bandit Simulation: Policy Evaluation Metrics<\/caption>","data":[["1","2","3","4"],["Empirical Bias on Policy Value","Average relative error on Policy Value","RMSE of errors on Policy Value","Empirical Coverage of Confidence Intervals"],[-0.02093,-0.03638,0.50223,0.95]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Metric<\/th>\n      <th>Value<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"columnDefs":[{"className":"dt-right","targets":2},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"Metric","targets":1},{"name":"Value","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><hr>
</div>
<div class="section level2">
<h2 id="notes">Notes<a class="anchor" aria-label="anchor" href="#notes"></a>
</h2>
<ul>
<li>
<code>list_betas</code> is updated internally to track the true
parameters per simulation<br>
</li>
<li>The first simulation is discarded by design (due to writing issues
in <code>contextual</code>) even when
<code>do_parallel = FALSE</code>.</li>
</ul>
<hr>
</div>
<div class="section level2">
<h2 id="recommended-use-cases">Recommended Use Cases<a class="anchor" aria-label="anchor" href="#recommended-use-cases"></a>
</h2>
<ul>
<li>Validate bandit policies under repeated experiments<br>
</li>
<li>Compare bias and variance of different policy types<br>
</li>
<li>Analyze empirical coverage of confidence intervals<br>
</li>
<li>Stress-test policies under different batch sizes, sigma levels, or
dimensions</li>
</ul>
<hr>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>This simulation builds on:</p>
<ul>
<li>Contextual bandits (<code>contextual</code> package)<br>
</li>
<li>On-policy Cram estimation</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Yanis Vandecasteele.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
