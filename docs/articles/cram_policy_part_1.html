<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction &amp; Cram Policy part 1 ‚Ä¢ cramR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction &amp; Cram Policy part 1">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<!-- Load Inter font --><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&amp;display=swap" rel="stylesheet">
<style>
  :root {
    --primary-gradient: linear-gradient(135deg, #2c3e50, #3498db);
    --hover-shadow: 0 4px 15px rgba(0,0,0,0.2);
  }

  .navbar {
    background-color: rgba(255, 255, 255, 0.95); /* Light background with slight transparency */
    box-shadow: 0 2px 10px rgba(0,0,0,0.1); /* Optional shadow for depth */
  }

  body {
    padding-top: 80px;
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  }

  h1, h2, h3, h4, h5, h6 {
    font-family: 'Inter', sans-serif;
  }

  code, pre, kbd {
    font-family: 'JetBrains Mono', monospace;
    background-color: #f5f5f5;
    padding: 0.2em 0.4em;
    border-radius: 4px;
    font-size: 90%;
  }

  pre {
    overflow-x: auto;
  }

  pre code {
    padding: 1em;
    display: block;
  }

  .navbar-brand img {
    height: 40px;
    transition: transform 0.3s ease;
  }

  .navbar-brand:hover img {
    transform: scale(1.05);
  }

  .hero-banner {
    background: var(--primary-gradient);
    padding: 6rem 1rem;
    color: white;
    text-shadow: 0 2px 4px rgba(0,0,0,0.2);
  }

  .feature-card {
    background: white;
    border-radius: 12px;
    padding: 2rem;
    margin: 1rem;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    transition: all 0.3s ease;
  }

  .feature-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--hover-shadow);
  }

  /* Add hover effect to make the navbar more readable */
  .navbar:hover {
    background-color: rgba(255, 255, 255, 1); /* Fully visible on hover */
  }

  /* Add space below the navbar to prevent cutting off content */
  main {
    padding-top: 1rem;
  }
</style>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">cramR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/cram_policy_part_1.html">Introduction &amp; Cram Policy part 1</a></li>
    <li><a class="dropdown-item" href="../articles/quickstart.html">Quick Start</a></li>
    <li><a class="dropdown-item" href="../articles/cram_policy_part_2.html">Cram Policy part 2</a></li>
    <li><a class="dropdown-item" href="../articles/cram_ml.html">Cram ML</a></li>
    <li><a class="dropdown-item" href="../articles/cram_bandit.html">Cram Bandit</a></li>
    <li><a class="dropdown-item" href="../articles/cram_bandit_helpers.html">Cram Bandit Helpers</a></li>
    <li><a class="dropdown-item" href="../articles/cram_policy_simulation.html">Cram Policy Simulation</a></li>
    <li><a class="dropdown-item" href="../articles/cram_bandit_simulation.html">Cram Bandit Simulation</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-resources" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Resources</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-resources">
<li><a class="dropdown-item" href="../reference/index.html">Function Reference</a></li>
    <li><a class="dropdown-item" href="../news/index.html">Release Notes</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/yanisvdc/cramR" aria-label="GitHub repository"><span class="fa fa-brands fa-github"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://www.hbs.edu/ris/Publication%20Files/2403.07031v1_a83462e0-145b-4675-99d5-9754aa65d786.pdf" aria-label="Research paper"><span class="fa fa-solid fa-file-pdf"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<link href="cram_policy_part_1_files/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="cram_policy_part_1_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><link href="cram_policy_part_1_files/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="cram_policy_part_1_files/datatables-binding-0.33/datatables.js"></script><link href="cram_policy_part_1_files/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="cram_policy_part_1_files/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="cram_policy_part_1_files/dt-core-1.13.6/js/jquery.dataTables.min.js"></script><link href="cram_policy_part_1_files/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="cram_policy_part_1_files/crosstalk-1.2.1/js/crosstalk.min.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Introduction &amp; Cram Policy part 1</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/yanisvdc/cramR/blob/HEAD/vignettes/cram_policy_part_1.Rmd" class="external-link"><code>vignettes/cram_policy_part_1.Rmd</code></a></small>
      <div class="d-none name"><code>cram_policy_part_1.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction-what-is-the-cram-method">Introduction: What is the Cram Method?<a class="anchor" aria-label="anchor" href="#introduction-what-is-the-cram-method"></a>
</h2>
<p>The Cram method is a powerful approach for simultaneously learning
and evaluating decision rules, such as individualized treatment rules
(ITRs), from data. Common applications include healthcare (who to
treat), pricing and advertising (who to target or how much to charge),
and policy (who to support).</p>
<p>Unlike traditional approaches like <strong>sample splitting</strong>
or <strong>cross-validation</strong>, which waste part of the data on
evaluation only, <strong>Cram reuses all available data</strong>
efficiently.</p>
<p>A key distinction from <strong>cross-validation</strong> is that Cram
evaluates the final learned model, rather than averaging performance
across multiple models trained on different data splits.</p>
<p>Cram:</p>
<ul>
<li><p>Simultaneously trains a model and evaluates the final learned
decision rule using all available data to improve statistical efficiency
and precision‚Äîunlike cross-validation or sample splitting, which reserve
part of the data for evaluation only.</p></li>
<li><p>Learns in cumulative batches, using each new round of data to
refine the model and check whether it‚Äôs actually improving‚Äîensuring that
learning translates into meaningful gains.</p></li>
<li>
<p>Estimates the expected outcome across the entire population as if
the policy learned on a data sample were applied to everyone in the
population, and not just to the data sample (statistical quantity called
‚Äúpolicy value‚Äù), which allows the user to assess how the learned policy
would generalize beyond the data sample.</p>
<blockquote>
<p>üõ†Ô∏è Think of Cram like a cram school: learn a bit, test a bit, repeat
‚Äî getting better while constantly self-evaluating.</p>
</blockquote>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="the-cram-workflow">The Cram Workflow<a class="anchor" aria-label="anchor" href="#the-cram-workflow"></a>
</h2>
<p>Below is the core idea of the Cram method visualized:</p>
<div class="float">
<img src="cram_visual_1.png" alt="¬†"><div class="figcaption">¬†</div>
</div>
<p>This procedure ensures each update is backed by performance testing,
enabling <strong>both learning and evaluation in one pass</strong> over
the data.</p>
<div class="float">
<img src="cram_visual_3.png" alt="¬†"><div class="figcaption">¬†</div>
</div>
<p>Note: this schematic represents how Cram estimates the difference in
policy value (see the definition of policy value above) relative to a
baseline policy - an example of baseline policy in healthcare would be
to treat nobody (all-zeros) or to randomly treat individuals (assign 1
for treatment and 0 for no treatment randomly); the policy value
difference ‚ÄúDelta‚Äù gives you how much better (or worse) is the policy
learned by Cram on the data relative to the baseline policy - but Cram
can also be used to estimate the policy value of the learned policy
directly, without the need to specify a baseline policy (not presented
here as part of the introduction but available in the outputs of the
main functions of Cram; see result table below).</p>
</div>
<div class="section level2">
<h2 id="the-cram_policy-function">The <code>cram_policy()</code> Function<a class="anchor" aria-label="anchor" href="#the-cram_policy-function"></a>
</h2>
<p>The <code><a href="../reference/cram_policy.html">cram_policy()</a></code> function in <strong>cramR</strong>
implements the Cram framework for binary treatment policy learning.</p>
<div class="section level3">
<h3 id="key-features-of-cram_policy">üîë Key Features of <code>cram_policy()</code><a class="anchor" aria-label="anchor" href="#key-features-of-cram_policy"></a>
</h3>
<ul>
<li><p><strong>Model-Agnostic Flexibility</strong>: Supports a variety
of learning strategies, including <code>causal_forest</code>,
<code>s_learner</code>, and <code>m_learner</code>, as well as fully
customizable learners via user-defined fit and predict
functions.</p></li>
<li><p><strong>Efficient by Design</strong>: Built on top of
<code>data.table</code> for fast, memory-efficient computation, with
optional support for parallel batch training to scale across larger
datasets.</p></li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="example-running-cram-policy-on-simulated-data">Example: Running Cram Policy on simulated data<a class="anchor" aria-label="anchor" href="#example-running-cram-policy-on-simulated-data"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="co"># Function to generate sample data with heterogeneous treatment effects:</span></span>
<span><span class="co"># - Positive effect group</span></span>
<span><span class="co"># - Neutral effect group</span></span>
<span><span class="co"># - Adverse effect group</span></span>
<span><span class="va">generate_data</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span></span>
<span>    binary <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span>,                 <span class="co"># Binary variable</span></span>
<span>    discrete <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,  <span class="co"># Discrete variable</span></span>
<span>    continuous <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>                       <span class="co"># Continuous variable</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Binary treatment assignment (50% treated)</span></span>
<span>  <span class="va">D</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Define heterogeneous treatment effects based on X</span></span>
<span>  <span class="va">treatment_effect</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span></span>
<span>    <span class="va">X</span><span class="op">[</span>, <span class="va">binary</span><span class="op">]</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">X</span><span class="op">[</span>, <span class="va">discrete</span><span class="op">]</span> <span class="op">&lt;=</span> <span class="fl">2</span>,        <span class="co"># Group 1: Positive effect</span></span>
<span>    <span class="fl">1</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span>, <span class="va">binary</span><span class="op">]</span> <span class="op">==</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">X</span><span class="op">[</span>, <span class="va">discrete</span><span class="op">]</span> <span class="op">&gt;=</span> <span class="fl">4</span>, <span class="co"># Group 3: Adverse effect</span></span>
<span>           <span class="op">-</span><span class="fl">1</span>,</span>
<span>           <span class="fl">0.1</span><span class="op">)</span>                                   <span class="co"># Group 2: Neutral effect</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Outcome depends on treatment effect + noise</span></span>
<span>  <span class="va">Y</span> <span class="op">&lt;-</span> <span class="va">D</span> <span class="op">*</span> <span class="op">(</span><span class="va">treatment_effect</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">D</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X</span>, D <span class="op">=</span> <span class="va">D</span>, Y <span class="op">=</span> <span class="va">Y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Generate a sample dataset</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">generate_data</span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">X</span></span>
<span><span class="va">D</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">D</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">Y</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Options for batch:</span></span>
<span><span class="co"># Either an integer specifying the number of batches or a vector/list of batch assignments for all individuals</span></span>
<span><span class="va">batch</span> <span class="op">&lt;-</span> <span class="fl">20</span></span>
<span></span>
<span><span class="co"># Model type for estimating treatment effects</span></span>
<span><span class="co"># Options for model_type: 'causal_forest', 's_learner', 'm_learner'</span></span>
<span><span class="co"># Note: you can also set model_type to NULL and specify custom_fit and custom_predict to use your custom model</span></span>
<span><span class="va">model_type</span> <span class="op">&lt;-</span> <span class="st">"causal_forest"</span>  </span>
<span></span>
<span><span class="co"># Options for learner_type:</span></span>
<span><span class="co"># if model_type == 'causal_forest', choose NULL</span></span>
<span><span class="co"># if model_type == 's_learner' or 'm_learner', choose between 'ridge', 'fnn' and 'caret'</span></span>
<span><span class="va">learner_type</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>  </span>
<span></span>
<span><span class="co"># Baseline policy to compare against (list of 0/1 for each individual)</span></span>
<span><span class="co"># Options for baseline_policy:</span></span>
<span><span class="co"># A list representing the baseline policy assignment for each individual.</span></span>
<span><span class="co"># If NULL, a default baseline policy of zeros is created.</span></span>
<span><span class="co"># Examples of baseline policy: </span></span>
<span><span class="co"># - All-control baseline: as.list(rep(0, nrow(X))) or NULL</span></span>
<span><span class="co"># - Randomized baseline: as.list(sample(c(0, 1), nrow(X), replace = TRUE))</span></span>
<span><span class="va">baseline_policy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>  </span>
<span></span>
<span><span class="co"># Whether to parallelize batch processing (i.e. the cram method learns T policies, with T the number of batches.</span></span>
<span><span class="co"># They are learned in parallel when parallelize_batch is TRUE</span></span>
<span><span class="co"># vs. learned sequentially using the efficient data.table structure when parallelize_batch is FALSE, recommended for light weight training).</span></span>
<span><span class="co"># Defaults to FALSE.</span></span>
<span><span class="va">parallelize_batch</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span>  </span>
<span> </span>
<span></span>
<span><span class="co"># Model-specific parameters (more details in the article "Cram Policy part 2")</span></span>
<span><span class="co"># Examples: NULL defaults to the following:</span></span>
<span><span class="co"># - causal_forest: list(num.trees = 100)</span></span>
<span><span class="co"># - ridge: list(alpha = 1)</span></span>
<span><span class="co"># - caret: list(formula = Y ~ ., caret_params = list(method = "lm", trControl = trainControl(method = "none")))</span></span>
<span><span class="co"># - fnn (Feedforward Neural Network): see below</span></span>
<span><span class="co"># input_shape &lt;- if (model_type == "s_learner") ncol(X) + 1 else ncol(X)</span></span>
<span><span class="co"># default_model_params &lt;- list(</span></span>
<span><span class="co">#       input_layer = list(units = 64, activation = 'relu', input_shape = input_shape),</span></span>
<span><span class="co">#       layers = list(</span></span>
<span><span class="co">#         list(units = 32, activation = 'relu')</span></span>
<span><span class="co">#       ),</span></span>
<span><span class="co">#       output_layer = list(units = 1, activation = 'linear'),</span></span>
<span><span class="co">#       compile_args = list(optimizer = 'adam', loss = 'mse'),</span></span>
<span><span class="co">#       fit_params = list(epochs = 5, batch_size = 32, verbose = 0)</span></span>
<span><span class="co">#     )</span></span>
<span><span class="va">model_params</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>  </span>
<span></span>
<span></span>
<span><span class="co"># Significance level for confidence intervals (default = 95%)</span></span>
<span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fl">0.05</span>  </span>
<span></span>
<span><span class="co"># Run the Cram policy method</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cram_policy.html">cram_policy</a></span><span class="op">(</span></span>
<span>  <span class="va">X</span>, <span class="va">D</span>, <span class="va">Y</span>,</span>
<span>  batch <span class="op">=</span> <span class="va">batch</span>,</span>
<span>  model_type <span class="op">=</span> <span class="va">model_type</span>,</span>
<span>  learner_type <span class="op">=</span> <span class="va">learner_type</span>,</span>
<span>  baseline_policy <span class="op">=</span> <span class="va">baseline_policy</span>,</span>
<span>  parallelize_batch <span class="op">=</span> <span class="va">parallelize_batch</span>,</span>
<span>  model_params <span class="op">=</span> <span class="va">model_params</span>,</span>
<span>  alpha <span class="op">=</span> <span class="va">alpha</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display the results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co">#&gt; $raw_results</span></span>
<span><span class="co">#&gt;                        Metric   Value</span></span>
<span><span class="co">#&gt; 1              Delta Estimate 0.23208</span></span>
<span><span class="co">#&gt; 2        Delta Standard Error 0.05862</span></span>
<span><span class="co">#&gt; 3              Delta CI Lower 0.11718</span></span>
<span><span class="co">#&gt; 4              Delta CI Upper 0.34697</span></span>
<span><span class="co">#&gt; 5       Policy Value Estimate 0.21751</span></span>
<span><span class="co">#&gt; 6 Policy Value Standard Error 0.05237</span></span>
<span><span class="co">#&gt; 7       Policy Value CI Lower 0.11486</span></span>
<span><span class="co">#&gt; 8       Policy Value CI Upper 0.32016</span></span>
<span><span class="co">#&gt; 9          Proportion Treated 0.60500</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $interactive_table</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $final_policy_model</span></span>
<span><span class="co">#&gt; GRF forest object of type causal_forest </span></span>
<span><span class="co">#&gt; Number of trees: 100 </span></span>
<span><span class="co">#&gt; Number of training samples: 1000 </span></span>
<span><span class="co">#&gt; Variable importance: </span></span>
<span><span class="co">#&gt;     1     2     3 </span></span>
<span><span class="co">#&gt; 0.437 0.350 0.213</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="interpreting-results">Interpreting Results<a class="anchor" aria-label="anchor" href="#interpreting-results"></a>
</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span><span class="op">$</span><span class="va">raw_results</span></span>
<span><span class="co">#&gt;                        Metric   Value</span></span>
<span><span class="co">#&gt; 1              Delta Estimate 0.23208</span></span>
<span><span class="co">#&gt; 2        Delta Standard Error 0.05862</span></span>
<span><span class="co">#&gt; 3              Delta CI Lower 0.11718</span></span>
<span><span class="co">#&gt; 4              Delta CI Upper 0.34697</span></span>
<span><span class="co">#&gt; 5       Policy Value Estimate 0.21751</span></span>
<span><span class="co">#&gt; 6 Policy Value Standard Error 0.05237</span></span>
<span><span class="co">#&gt; 7       Policy Value CI Lower 0.11486</span></span>
<span><span class="co">#&gt; 8       Policy Value CI Upper 0.32016</span></span>
<span><span class="co">#&gt; 9          Proportion Treated 0.60500</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span><span class="op">$</span><span class="va">interactive_table</span></span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-e5c8c404fe174e4c81bd" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-e5c8c404fe174e4c81bd">{"x":{"filter":"none","vertical":false,"caption":"<caption>CRAM Experiment Results<\/caption>","data":[["1","2","3","4","5","6","7","8","9"],["Delta Estimate","Delta Standard Error","Delta CI Lower","Delta CI Upper","Policy Value Estimate","Policy Value Standard Error","Policy Value CI Lower","Policy Value CI Upper","Proportion Treated"],[0.23208,0.05862,0.11718,0.34697,0.21751,0.05237,0.11486,0.32016,0.605]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Metric<\/th>\n      <th>Value<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"columnDefs":[{"className":"dt-right","targets":2},{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"Metric","targets":1},{"name":"Value","targets":2}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script><p>The output of <code><a href="../reference/cram_policy.html">cram_policy()</a></code> includes:</p>
<ul>
<li>
<p><strong><code>raw_results</code></strong>: A data frame
summarizing key evaluation metrics:</p>
<ul>
<li>
<strong><code>Delta Estimate</code></strong>: The estimated policy
value difference i.e.¬†improvement in outcomes from using the final
learned policy compared to a baseline (e.g., no treatment or
treat-all).<br>
</li>
<li>
<strong><code>Delta Standard Error</code></strong> and
<strong>confidence interval bounds</strong>: Reflect the uncertainty
around the delta estimate.<br>
</li>
<li>
<strong><code>Policy Value Estimate</code></strong>: The estimated
policy value i.e.¬†average outcome if the final learned policy were
applied across the population.<br>
</li>
<li>
<strong><code>Policy Value Standard Error</code></strong> and
<strong>confidence interval bounds</strong>: Reflect uncertainty in the
policy value estimate.<br>
</li>
<li>
<strong><code>Proportion Treated</code></strong>: The fraction of
the population that would be treated under the learned policy.</li>
</ul>
</li>
<li><p><strong><code>interactive_table</code></strong>: A dynamic,
scrollable version of <code>raw_results</code> for easier exploration
and filtering.</p></li>
<li><p><strong><code>final_policy_model</code></strong>: The trained
policy model object itself, fitted according to the specified
<code>model_type</code>, <code>learner_type</code>, or user-provided
<code>custom_fit</code> and <code>custom_predict</code> (more details in
the article ‚ÄúCram Policy part 2‚Äù). This object can be used for further
analysis or for applying the learned policy to new data.</p></li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">final_policy_model</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "causal_forest" "grf"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">final_policy_model</span><span class="op">)</span></span>
<span><span class="co">#&gt;                          Length Class  Mode   </span></span>
<span><span class="co">#&gt; _ci_group_size              1   -none- numeric</span></span>
<span><span class="co">#&gt; _num_variables              1   -none- numeric</span></span>
<span><span class="co">#&gt; _num_trees                  1   -none- numeric</span></span>
<span><span class="co">#&gt; _root_nodes               100   -none- list   </span></span>
<span><span class="co">#&gt; _child_nodes              100   -none- list   </span></span>
<span><span class="co">#&gt; _leaf_samples             100   -none- list   </span></span>
<span><span class="co">#&gt; _split_vars               100   -none- list   </span></span>
<span><span class="co">#&gt; _split_values             100   -none- list   </span></span>
<span><span class="co">#&gt; _drawn_samples            100   -none- list   </span></span>
<span><span class="co">#&gt; _send_missing_left        100   -none- list   </span></span>
<span><span class="co">#&gt; _pv_values                100   -none- list   </span></span>
<span><span class="co">#&gt; _pv_num_types               1   -none- numeric</span></span>
<span><span class="co">#&gt; predictions              1000   -none- numeric</span></span>
<span><span class="co">#&gt; variance.estimates          0   -none- numeric</span></span>
<span><span class="co">#&gt; debiased.error           1000   -none- numeric</span></span>
<span><span class="co">#&gt; excess.error             1000   -none- numeric</span></span>
<span><span class="co">#&gt; seed                        1   -none- numeric</span></span>
<span><span class="co">#&gt; num.threads                 1   -none- numeric</span></span>
<span><span class="co">#&gt; ci.group.size               1   -none- numeric</span></span>
<span><span class="co">#&gt; X.orig                   3000   -none- numeric</span></span>
<span><span class="co">#&gt; Y.orig                   1000   -none- numeric</span></span>
<span><span class="co">#&gt; W.orig                   1000   -none- numeric</span></span>
<span><span class="co">#&gt; Y.hat                    1000   -none- numeric</span></span>
<span><span class="co">#&gt; W.hat                    1000   -none- numeric</span></span>
<span><span class="co">#&gt; clusters                    0   -none- numeric</span></span>
<span><span class="co">#&gt; equalize.cluster.weights    1   -none- logical</span></span>
<span><span class="co">#&gt; tunable.params              7   -none- list   </span></span>
<span><span class="co">#&gt; has.missing.values          1   -none- logical</span></span></code></pre></div>
<p>You can inspect or apply the learned model to new data.</p>
</div>
<div class="section level2">
<h2 id="visual-summary-and-notes">Visual Summary and Notes<a class="anchor" aria-label="anchor" href="#visual-summary-and-notes"></a>
</h2>
<div class="float">
<img src="cram_visual_2.png" alt="¬†"><div class="figcaption">¬†</div>
</div>
<p>This visualization summarizes how multiple evaluations across
iterations contribute to the full Cram estimate.</p>
<p>Notes:</p>
<ul>
<li>
<strong>Batching</strong>: You can pass a number (e.g.,
<code>batch = 5</code>) or a custom vector to control how data is
split.<br>
</li>
<li>
<strong>Parallelization</strong>: Enable with
<code>parallelize_batch = TRUE</code>.<br>
</li>
<li>
<strong>Custom Learners</strong>: Use <code>custom_fit</code> and
<code>custom_predict</code> to plug in any estimator. (more details in
the article ‚ÄúCram Policy part 2‚Äù)</li>
</ul>
</div>
<div class="section level2">
<h2 id="comparing-evaluation-strategies-sample-splitting-cross-validation-and-cram">üìê Comparing Evaluation Strategies: Sample-Splitting,
Cross-Validation, and Cram<a class="anchor" aria-label="anchor" href="#comparing-evaluation-strategies-sample-splitting-cross-validation-and-cram"></a>
</h2>
<p>In this section, we compare classical strategies for model
evaluation‚Äînamely sample-splitting and cross-validation‚Äîwith the Cram
method. While all three approaches may ultimately train a model using
the full dataset, they differ fundamentally in how they estimate the
generalization performance of that model.</p>
<div class="section level3">
<h3 id="sample-splitting">üîç Sample-Splitting<a class="anchor" aria-label="anchor" href="#sample-splitting"></a>
</h3>
<p>Sample-splitting divides the data into a training set and a held-out
test set (e.g., 80/20). The model is trained on the training portion,
and its performance is assessed on the held-out set. This procedure
produces an evaluation of a model that was not trained on all the data,
which may understate the performance of the final model trained on the
full dataset. Thus, the evaluation corresponds to:</p>
<ul>
<li>A partially trained model (fit on, say, 80% of the data),</li>
<li>Evaluated on unseen data (the held-out 20%).</li>
</ul>
<p>This raises two issues:</p>
<ul>
<li>The model being evaluated is not the final model we would deploy
(it‚Äôs undertrained).</li>
<li>The evaluation uses only part of the available data, reducing
statistical efficiency.</li>
</ul>
</div>
<div class="section level3">
<h3 id="cross-validation">üîÑ Cross-Validation<a class="anchor" aria-label="anchor" href="#cross-validation"></a>
</h3>
<p>We consider k-fold cross-validation, which partitions the data into k
equal-sized folds. For each fold, a model is trained on the remaining
k-1 folds and evaluated on the held-out fold. This process ensures that
each observation is used for both training and evaluation, but in
different models. The final performance estimate is the average of
fold-specific evaluation metrics and serves as a proxy for the expected
performance of the model that would be trained on the full dataset.</p>
<ul>
<li>Each model is trained on a subset of the data (e.g., 4 folds out of
5),</li>
<li>Evaluation is performed over the entire dataset, but using different
models for each portion.</li>
</ul>
<p>Thus, while cross-validation uses all data for evaluation, it only
evaluates models trained on partial data. Crucially, the final model
trained on the full dataset is never evaluated directly; its performance
is approximated by averaging over surrogate models trained on
subsets.</p>
</div>
<div class="section level3">
<h3 id="cram">üìà Cram<a class="anchor" aria-label="anchor" href="#cram"></a>
</h3>
<p>Cram departs from these approaches by directly targeting the
performance of the final model trained on the entire dataset, casting
evaluation as a statistical estimation problem: it estimates the
population-level performance (e.g., expected outcome or loss) that the
model would achieve if deployed.</p>
<p>Specifically:</p>
<ul>
<li>Cram trains a sequence of models on cumulative batches and evaluates
each on the remaining data, as described in Algorithm 1,</li>
<li>Then uses statistical estimators to estimate the expected
performance of the final model trained on the entire dataset‚Äîi.e., the
outcome we would observe if this model were deployed at the population
level beyond the observed sample,</li>
<li>It provides confidence intervals around this estimate, which
quantify uncertainty: for example, a 95% confidence interval is
constructed such that, under repeated samples from the same
data-generating process, the interval would contain the true expected
performance in 95% of cases.</li>
</ul>
</div>
<div class="section level3">
<h3 id="key-distinction-summary-what-is-being-evaluated">üß† Key Distinction Summary: What Is Being Evaluated?<a class="anchor" aria-label="anchor" href="#key-distinction-summary-what-is-being-evaluated"></a>
</h3>
<p>All methods aim to estimate the generalization performance of a model
trained on the full dataset* (denoted as final model in the table below
for readability). However, they differ in the <em>models trained during
evaluation</em>, <em>the data used for evaluation</em>, and <em>how the
final performance estimate is constructed</em>.</p>
<table class="table">
<colgroup>
<col width="8%">
<col width="15%">
<col width="22%">
<col width="13%">
<col width="39%">
</colgroup>
<thead><tr class="header">
<th>Method</th>
<th>Target of Evaluation</th>
<th>Evaluation Models Trained</th>
<th>Evaluation Data Used</th>
<th>Evaluation Mechanism</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Sample-Splitting</td>
<td>Generalization performance of final model*</td>
<td>One model trained on a subset</td>
<td>Held-out subset</td>
<td>Empirical performance on test set</td>
</tr>
<tr class="even">
<td>Cross-Validation</td>
<td>Generalization performance of final model*</td>
<td>
<em>k</em> models trained on different subsets</td>
<td>Entire data (across folds)</td>
<td>Average of fold-specific evaluation metrics</td>
</tr>
<tr class="odd">
<td>Cram</td>
<td>Generalization performance of final model*</td>
<td>Sequence of models trained on cumulative batches</td>
<td>Entire data</td>
<td>Statistical estimation targeting generalization performance of final
model; provides confidence intervals and inference</td>
</tr>
</tbody>
</table>
<p>final model*: model trained on the full dataset</p>
<ul>
<li>
<strong>Sample-splitting</strong> trains a single model on a subset
of the data and evaluates it on a held-out portion. This is simple but
statistically inefficient.</li>
<li>
<strong>Cross-validation</strong> trains multiple models, each on a
subset of the data, and evaluates each on its corresponding held-out
fold. The fold-specific evaluation metrics are then averaged to
approximate the final model‚Äôs performance. Although commonly used as a
proxy for the generalization performance of the final model, this
average does not directly target or estimate the performance of the
model trained on the full dataset.</li>
<li>
<strong>Cram</strong> trains models on cumulative data batches and
evaluates each on the remaining data. It uses these evaluations to
statistically estimate the generalization performance of the final model
trained on all data, providing both a point estimate and valid
confidence intervals for the expected performance if deployed.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ul>
<li>Jia, Z., Imai, K., &amp; Li, M. L. (2024). <em>The Cram Method for
Efficient Simultaneous Learning and Evaluation</em>, URL: <a href="https://www.hbs.edu/ris/Publication%20Files/2403.07031v1_a83462e0-145b-4675-99d5-9754aa65d786.pdf" class="external-link uri">https://www.hbs.edu/ris/Publication%20Files/2403.07031v1_a83462e0-145b-4675-99d5-9754aa65d786.pdf</a>.<br>
</li>
<li>K√ºnzel, S. R., Sekhon, J. S., Bickel, P. J., &amp; Yu, B. (2019).
Metalearners for estimating heterogeneous treatment effects using
machine learning. Proceedings of the National Academy of Sciences of the
United States of America, 116(10), 4156‚Äì4165. <a href="https://doi.org/10.1073/pnas.1804597116" class="external-link uri">https://doi.org/10.1073/pnas.1804597116</a>
</li>
<li>Wager, S., &amp; Athey, S. (2018). Estimation and inference of
heterogeneous treatment effects using random forests. Journal of the
American Statistical Association, 113(523), 1228-1242.</li>
<li>Athey, S., &amp; Imbens, G. (2016). Recursive partitioning for
heterogeneous causal effects. Proceedings of the National Academy of
Sciences, 113(27), 7353-7360.</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Yanis Vandecasteele.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
